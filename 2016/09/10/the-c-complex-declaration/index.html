<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="个人博客"><title>C语言复杂声明 | Torival's blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/3.0.3/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">C语言复杂声明</h1><a id="logo" href="/.">Torival's blog</a><p class="description">Things are beautiful if you love them</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">C语言复杂声明</h1><div class="post-meta">Sep 10, 2016<span> | </span><span class="category"><a href="/categories/Science/">Science</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-disqus-identifier="2016/09/10/the-c-complex-declaration/" href="/2016/09/10/the-c-complex-declaration/#disqus_thread" class="disqus-comment-count"></a><div class="post-content"><p>最近看了几天的 K&amp;R 的&lt; C程序设计语言 &gt;第二版，当读到的第5.12章的复杂函数声明是，我真是一脸蒙逼。之前虽然匆匆使用过几次函数指针，。就像快排的一样。虽说有点难度，但是当时还是能看懂的。</p>
<h2 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">void qsort(void *v[], int left, int right, int (*comp)(void *, void *)) &#123;</span><br><span class="line">    int i, last;</span><br><span class="line">    void swap(void *v[], int, int);</span><br><span class="line">    </span><br><span class="line">    if(left &gt;= right)</span><br><span class="line">        return;</span><br><span class="line">    </span><br><span class="line">    swap(v, left, (left + right)/2);</span><br><span class="line">    last = left;</span><br><span class="line">    </span><br><span class="line">    for(i = left+1; i &lt;= right; i++)</span><br><span class="line">        if((*comp)(v[i], v[left]) &lt; 0)</span><br><span class="line">            swap(v, ++last, i);</span><br><span class="line">    </span><br><span class="line">    swap(v, left, last);</span><br><span class="line">    qsort(v, left, last-1, comp);</span><br><span class="line">    qsort(v, last+1, right, comp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int cmp(char* s1, char* s2) &#123;</span><br><span class="line">    double v1, v2;</span><br><span class="line">    </span><br><span class="line">    v1 = atof(s1);</span><br><span class="line">    v2 = atof(s2);</span><br><span class="line">    </span><br><span class="line">    if (v1 &lt; v2)</span><br><span class="line">        return -1;</span><br><span class="line">    else if (v1 &gt; v2)</span><br><span class="line">        return 1;</span><br><span class="line">    else</span><br><span class="line">        return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void swap(void *v[], int i, int j) &#123;</span><br><span class="line">    void* temp;</span><br><span class="line">    </span><br><span class="line">    temp = v[i];</span><br><span class="line">    v[i] = v[j];</span><br><span class="line">    v[j] = temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这段代码里面，<code>comp</code>为一个函数指针，在使用之前需要使其指向一个函数，就像<code>cmp</code>函数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int (*comp)(void *, void *);    //定义</span><br><span class="line">comp = cmp；        //指向cmp函数</span><br></pre></td></tr></table></figure>
<p>由于在C语言里面把<code>void*</code>当做通用指针，所以在参数传递上使用了<code>void*</code>。以方便在以后需要排序其他类型对象时，只需要给出比较方法，既<code>cmp</code>函数，就可比较。 但是在进行比较的时候得把他转换成原本的类型。书中介绍，在第一版时，也用<code>char*</code>做为通用指针。</p>
<h2 id="复杂声明"><a href="#复杂声明" class="headerlink" title="复杂声明"></a>复杂声明</h2><p>刚刚看的comp指针可能一脚容易明白，下面再看几个例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">int *day[13];</span><br><span class="line">void *comp();</span><br><span class="line">void (*comp)();</span><br><span class="line">char (*(*x())[])();</span><br><span class="line">char (*(*x[3])())[5];</span><br></pre></td></tr></table></figure>
<p>是不是只能认识前三个。不要紧，下面重点来了。</p>
<h3 id="右左法则"><a href="#右左法则" class="headerlink" title="右左法则"></a>右左法则</h3><p><strong>右左法则其实并不是C标准里面的内容</strong>，它是从C标准的声明规定中归纳出来的方法。C标准的声明规则，是用来解决如何创建声明的，而右左法则是用来解决如何辩识一个声明的，两者可以说是相反的。</p>
<p>The right-left rule: Start reading the declaration from the innermost parentheses, go right, and then go left. When you encounter parentheses, the direction should be reversed. Once everything in the parentheses has been parsed, jump out of it. Continue till the whole declaration has been parsed.</p>
<p>右左法则：首先从最里面的圆括号看起，然后往右看，再往左看。每当遇到圆括号时，就应该掉转阅读方向。一旦解析完圆括号里面所有的东西，就跳出圆括号。重复这个过程直到整个声明解析完毕。</p>
<p>网上有人说应该是未定义的标识符开始阅读，而不是从括号读起阅读。我试了一下，的确未定义的标识符容易理解一些。首先前三个就不说了，咱们直奔后俩个。</p>
<p>首先：一定得知道() / [] 的优先级都大于*。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">char (*(*x())[])();</span><br><span class="line"></span><br><span class="line">step1: x()                      右看</span><br><span class="line">    x是一个函数</span><br><span class="line">    </span><br><span class="line">step2: *x()                     左看</span><br><span class="line">    x是一个函数，该函数返回一个指针</span><br><span class="line">    </span><br><span class="line">step3: (*x())[]                 右看</span><br><span class="line">    x是一个函数，该函数返回一个指针，这个指针指向一个数组</span><br><span class="line">    </span><br><span class="line">step4: *(*x())[]                左看</span><br><span class="line">    x是一个函数，该函数返回一个指针，这个指针指向一个数组，该数组为指针数组</span><br><span class="line">    </span><br><span class="line">step5:(*(*x())[])()             右看</span><br><span class="line">    x是一个函数，该函数返回一个指针，这个指针指向一个数组，该数组为指针数组，每个指针为</span><br><span class="line">    函数指针</span><br><span class="line">    </span><br><span class="line">step6:char (*(*x())[])()        左看</span><br><span class="line">    x是一个函数，该函数返回一个指针，这个指针指向一个数组，该数组为指针数组，每个指针为</span><br><span class="line">    函数指针，函数返回char类型。</span><br><span class="line"></span><br><span class="line">其实实际中很少使用到过于复杂的声明，如果实在是用到复杂的声明，都会使用`typedef`进行合成。</span><br><span class="line"></span><br><span class="line">char (*(*x())[])();</span><br><span class="line"></span><br><span class="line">typedef *x() per1;</span><br><span class="line">typedef *(per1)[] per2Arr;</span><br><span class="line">char (per2Arr)();</span><br></pre></td></tr></table></figure>
<p>剩下的那一个复杂声明就当作练习吧，写的有点累…….﹋○﹋</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://torival.github.io/2016/09/10/the-c-complex-declaration/" data-id="cit6uv9jt000cx0vtwrehn4ch" class="article-share-link">分享到</a><div class="tags"><a href="/tags/C/">C</a></div><div class="post-nav"><a href="/2016/09/17/Shell-programming/" class="pre">Shell编程指南</a><a href="/2016/08/27/use-github-page-hexo-Build-blog/" class="next">github page + hexo 搭建博客</a></div><div id="disqus_thread"><script>var disqus_shortname = 'Torival';
var disqus_identifier = '2016/09/10/the-c-complex-declaration/';
var disqus_title = 'C语言复杂声明';
var disqus_url = 'http://torival.github.io/2016/09/10/the-c-complex-declaration/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//Torival.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://torival.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Science/">Science</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Shell/" style="font-size: 15px;">Shell</a> <a href="/tags/Assembly/" style="font-size: 15px;">Assembly</a> <a href="/tags/Algorithm/" style="font-size: 15px;">Algorithm</a> <a href="/tags/C/" style="font-size: 15px;">C</a> <a href="/tags/Blog/" style="font-size: 15px;">Blog</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/09/17/Shell-programming/">Shell编程指南</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/10/the-c-complex-declaration/">C语言复杂声明</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/27/use-github-page-hexo-Build-blog/">github page + hexo 搭建博客</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/22/base-data-structure/">简单数据结构：线性表、栈、队列</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/03/assembly-language-01/">CPU简述</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://forrestchang.github.io/" title="forrestchang" target="_blank">forrestchang</a><ul></ul><a href="http://mrnoknow.github.io/" title="Mr.Noknow" target="_blank">Mr.Noknow</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Torival's blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>