<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="个人博客"><title>三步上手GDB | Torival's blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">三步上手GDB</h1><a id="logo" href="/.">Torival's blog</a><p class="description">Things are beautiful if you love them</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">三步上手GDB</h1><div class="post-meta">Jan 19, 2018<span> | </span><span class="category"><a href="/categories/Translate/">Translate</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a class="disqus-comment-count" data-disqus-identifier="2018/01/19/three-steps-to-learning-GDB/" href="/2018/01/19/three-steps-to-learning-GDB/#disqus_thread"></a><div class="post-content"><p>调试C程序，曾让我很困扰。然而当我之前在写我的<a href="http://jvns.ca/blog/categories/kernel" target="_blank" rel="external">操作系统</a>时，我有很多的BUG需要调试。我很幸运的使用上了qemu模拟器，它允许我将调试器附加到我的操作系统。这个调试器就是<code>gdb</code>。</p>
<p>我得解释一下，你可以使用<code>gdb</code>先做一些小事情，因为我发现初学它的时候真的很混乱。我们接下来会在一个小程序中，设置断点，查看内存。.</p>
<h3 id="1-设断点"><a href="#1-设断点" class="headerlink" title="1. 设断点"></a>1. 设断点</h3><p>如果你曾经使用过调试器，那你可能已经会设置断点了。</p>
<p>下面是一个我们要调试的程序（虽然没有任何Bug）:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_thing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Hi!\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    do_thing();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>另存为 <code>hello.c</code>. 我们可以使用dbg调试它，像这样:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bork@kiwi ~&gt; gcc -g hello.c -o hello</span><br><span class="line">bork@kiwi ~&gt; gdb ./hello</span><br></pre></td></tr></table></figure>
<p>以上是带调试信息编译 <code>hello.c</code>（为了gdb可以更好工作），并且它会给我们醒目的提示符，就像这样：<br><code>(gdb)</code></p>
<p>我们可以使用<code>break</code>命令设置断点，然后使用<code>run</code>开始调试程序。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(gdb) break do_thing </span><br><span class="line">Breakpoint 1 at 0x4004f8</span><br><span class="line">(gdb) run</span><br><span class="line">Starting program: /home/bork/hello </span><br><span class="line"></span><br><span class="line">Breakpoint 1, 0x00000000004004f8 in do_thing ()</span><br></pre></td></tr></table></figure>
<p>程序暂停在了<code>do_thing</code>开始的地方。</p>
<p>我们可以通过<code>where</code>查看我们所在的调用栈。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(gdb) where</span><br><span class="line">#0  do_thing () at hello.c:3</span><br><span class="line">#1  0x08050cdb in main () at hello.c:6</span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure></p>
<h3 id="2-阅读汇编代码"><a href="#2-阅读汇编代码" class="headerlink" title="2. 阅读汇编代码"></a>2. 阅读汇编代码</h3><p>使用<code>disassemble</code>命令，我们可以看到这个函数的汇编代码。棒级了。这是x86汇编代码。虽然我不是很懂它，但是<code>callq</code>这一行是<code>printf</code>函数调用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(gdb) disassemble do_thing</span><br><span class="line">Dump of assembler code for function do_thing:</span><br><span class="line">   0x00000000004004f4 &lt;+0&gt;:     push   %rbp</span><br><span class="line">   0x00000000004004f5 &lt;+1&gt;:     mov    %rsp,%rbp</span><br><span class="line">=&gt; 0x00000000004004f8 &lt;+4&gt;:     mov    $0x40060c,%edi</span><br><span class="line">   0x00000000004004fd &lt;+9&gt;:     callq  0x4003f0 </span><br><span class="line">   0x0000000000400502 &lt;+14&gt;:    pop    %rbp</span><br><span class="line">   0x0000000000400503 &lt;+15&gt;:    retq</span><br></pre></td></tr></table></figure>
<p>你也可以使用<code>disassemble</code>的缩写<code>disas</code>。`</p>
<h3 id="3-查看内存"><a href="#3-查看内存" class="headerlink" title="3. 查看内存"></a>3. 查看内存</h3><p>当调试我的内核时，我使用<code>gdb</code>的主要原因是，以确保内存布局是如我所想的那样。检查内存的命令是<code>examine</code>，或者使用缩写<code>x</code>。我们将使用<code>x</code>。   </p>
<p>通过阅读上面的汇编代码，似乎<code>0x40060c</code>可能是我们所要打印的字符串地址。我们来试一下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/s 0x40060c</span><br><span class="line">0x40060c:        &quot;Hi!&quot;</span><br></pre></td></tr></table></figure>
<p>的确是这样。<code>x/s</code>中<code>/s</code>部分，意思是“把它作为字符串展示”。我也可以“展示10个字符”，像这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/10c 0x40060c</span><br><span class="line">0x40060c:       72 &apos;H&apos;  105 &apos;i&apos; 33 &apos;!&apos;  0 &apos;\000&apos;        1 &apos;\001&apos;        27 &apos;\033&apos;       3 &apos;\003&apos;        59 &apos;;&apos;</span><br><span class="line">0x400614:       52 &apos;4&apos;  0 &apos;\000&apos;</span><br></pre></td></tr></table></figure>
<p>你可以看到前四个字符是’H’，’i’，’!’，和’\0’，并且它们之后的是一些不相关的东西。</p>
<p>我知道gdb很多其他的东西，但是我任然不是很了解它，其中<code>x</code>和<code>break</code>让我获得很多。你还可以阅读 <a href="https://ftp.gnu.org/old-gnu/Manuals/gdb-5.1.1/html_chapter/gdb_9.html#SEC56" target="_blank" rel="external">do umentation for examining memory</a>。</p>
<hr>
<p>原文连接: <a href="https://jvns.ca/blog/2014/02/10/three-steps-to-learning-gdb/" target="_blank" rel="external">Three steps to learning GDB</a><br>作者：<a href="https://jvns.ca" target="_blank" rel="external">Julia Evans </a></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="http://torival.cn/2018/01/19/three-steps-to-learning-GDB/" data-id="cjclxic9x000058vtnglc2n5y" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACJ0lEQVR42u3aSW7DMAwF0N7/0um2RWDlU1QMWHpeFRlsvSxYTj8/8fUaXn8/8/731btXd3j/7rILAwPjsYz8iOPHXL1b/e74uZf3wcDAOIBxdetxuBy/Mj5K/t3x2TAwMDDGn8kD91xaiYGBgdEJuNGtY3ASfDEwMDDygFhN+PJj3VSLY2BgPJCRh8j7//7KfAMDA+NRjE7BWW2orS19/z0FAwNja8aqVlp1nJl/JjkPBgbG3ozxgTpt/eTO+TLZByoGBsZhjITUKYOrgThBYmBgnMDIs8hqYtdJKJMfDgMD4wRGZ2GiOjzojEjLy2oYGBgbMeba/Z2itJpuRikpBgbG1ow8HvcXI/pj0ejfAwYGxqaM/AFJAtc5SmfhAwMDY29GudIttu/zZlle1pZzXgwMjMcy+gF0rsXfGTZcJoUYGBjHMFatVsyVr3PDAwwMjL0ZeZDNk8XqGDKJmYV+IQYGxnaMufZWdZzZWQ6LimcMDIytGdXHl7t3jTFn/goGBsYJjFVLXQl17ucoJIgYGBgHMKqN+7Wt//x1DAwMjLnJYHXlorOi8SE1xMDA2IjxKl55c7+6bFEN4tGMFAMDYwvGqoWJ6n3mAnc++MTAwNiP0VnJ+vaKRqEYxsDAOICRF5l5Kz8vg2+qxTEwMDAamDzEl3c6MDAwjmTkCeXcEkZe+rZSQwwMjAcy+kurcwH6pkEmBgbGwxnVhn4CqyaFqzI9DAyM7Ri/eIayULux9YcAAAAASUVORK5CYII=">Share</a><div class="tags"><a href="/tags/C-C/">C/C++</a></div><div class="post-nav"><a class="next" href="/2018/01/10/display-hardware-information-in-linux/">python-hwinfo：展示硬件信息概况</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论 「请确保 disqus.com 可以正常加载」</button></div><script>var disqus_shortname = 'Torival';
var disqus_identifier = '2018/01/19/three-steps-to-learning-GDB/';
var disqus_title = '三步上手GDB';
var disqus_url = 'http://torival.cn/2018/01/19/three-steps-to-learning-GDB/';
$('.btn_click_load').click(function() {
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  $('.btn_click_load').css('display','none');
});
$.ajax({
  url: 'https://disqus.com/next/config.json',
  timeout: 3000,
  type: 'GET',
  success: (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    $('.btn_click_load').css('display','none');
  })(),
  error: function() {
    $('.btn_click_load').css('display','block');
  }
});</script><script id="dsq-count-scr" src="//Torival.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://torival.cn"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Life/">Life</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Science/">Science</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Translate/">Translate</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/Shell/" style="font-size: 15px;">Shell</a> <a href="/tags/Network/" style="font-size: 15px;">Network</a> <a href="/tags/Algorithm/" style="font-size: 15px;">Algorithm</a> <a href="/tags/Program/" style="font-size: 15px;">Program</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/C-C/" style="font-size: 15px;">C/C++</a> <a href="/tags/Chrome/" style="font-size: 15px;">Chrome</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/Blog/" style="font-size: 15px;">Blog</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/01/19/three-steps-to-learning-GDB/">三步上手GDB</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/10/display-hardware-information-in-linux/">python-hwinfo：展示硬件信息概况</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/31/introduce-mysql-architecture/">MySQL体系结构</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/12/some-useful-chrome-plugin-and-tools/">几个好用的Chrome插件及工具</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/07/wechat-recover/">记一次失败的微信记录恢复</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/15/a-simple-algorithm-problems/">一道简单的算法题</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/15/object-layout/">浅析C++对象布局</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/19/Simply-talking-about-computer-network/">简单谈谈计算机网络</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/03/how-did-the-program-work/">内功修炼：程序是如何运行起来的</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/09/terminal-query-tickets/">终端查询12306余票</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="http://forrestchang.github.io/" title="forrestchang" target="_blank">forrestchang</a><ul></ul><a href="http://mrnoknow.github.io/" title="Mr.Noknow" target="_blank">Mr.Noknow</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">Torival's blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" color="138,43,226" opacity="0.5" zIndex="-1" count="130" src="//cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>